# 서버 사이드 렌더링이란? (feat. SPA)

<br>

## 1. 싱글 페이지 애플리케이션이란?

서버 사이드 렌더링 애플리케이션과 반대되는 개념이라고 할 수 있다.

<br>

### 1) 싱글 페이지 애플리케이션 (SPA, Single Page Application)

---

`렌더링`과 `라우팅`에 필요한 대부분의 기능을 서버가 아닌 `브라우저의 자바스크립트에 의존`하는 방식

최초의 첫 페이지에서 데이터를 모두 불러온 이후 페이지를 전환을 위한 모든 작업이 자바스크립트와 브라우저의 `history.pushSate`와 `history.replaceState`로 이루어짐

<br>

즉, 첫 페이지를 불러온 이후 서버에서 HTML을 내려받지 않고, `하나의 페이지에서 모든 작업을 처리하는 방식`

<br>

### 2) 장/단점

---

새로운 HTML 페이지를 요청하는 것이 아니라, 페이지에 대해 필요한 정보만 HTTP 요청 등으로 받아와 적용함

**단점**: 최초에 로딩해야 할 자바스크립트 리소스가 커짐

**장점**: 한번 로딩된 이후에는 서버를 거쳐 필요한 리소스를 받아오는 일이 적어져서 향상된 UI/UX 제공 가능

<br>

### 3) 번외. 웹 기술 스택

---

**LAMP 스택**

- 기존에 인기있던 웹 개발 구조
- Linux(운영체제), Apache(서버), MySQL(데이터베이스), PHP/Python등(웹 프레임워크)
- 과거에는 자바스크립트에서 할 수 있는 일이 제한적이라, 서버에서 많은 일을 처리함
- 웹 애플리케이션 확장에 걸림돌이 되었음

**JAM 스택**

- `React`, `Vue`, `Angular` 의 등장 → 자바스크립트로 처리할 수 있는 일이 증가 → JAM 스택 등장
- JavaScript(동적인 요소 처리), API(서버와의 통신), Markup(HTML)

**MEAN 스택, MERN 스택**

- API 서버 자체도 자바스크립트로 구현하는 구조
- MEAN : MongoDB, Express.js, AngularJS, Node.js
- MERN : MongoDB, Express.js, React, Node.js

<br>

## 2. 서버 사이드 렌더링이란?

웹에서 많은 것을 처리하기 때문에 속도가 느려지는 `SPA의 한계를 개선`하기 위해 다시 떠오르는 방식이다.

<br>

### 1) 서버 사이드 렌더링 (SSR, Server Side Rendering)

---

최초에 사용자에게 보여줄 페이지를 `서버에서 렌더링`해 사용자에게 화면을 제공하는 방식

<br>

**SPA와 SSR의 주된 차이점 → 웹 페이지 렌더링 책임을 어디에 두는 것인가**

- SPA : 사용자에게 제공되는 `자바스크립트 번들`에서 렌더링을 담당
- SSR : 렌더링에 필요한 작업을 모두 `서버`에서 담당


![alt text](<스크린샷 2024-05-22 오후 11.28.11.png>)
https://lvivity.com/single-page-app-vs-multi-page-app

<br>

### 2) 장점

---

**최초 페이지 진입이 비교적 빠르다**

- SPA에서 화면에 표시해야 할 정보가 API 호출에 많이 의존할 경우
- 일반적으로 `서버에서 처리`하는 것이 더 빠름 (사용자가 몰려 서버의 리소스가 적으면 느려질 수 있긴하다.)

<br>

**검색 엔진과 SNS 공유 등 메타데이터 제공이 쉽다**

- `검색 엔진 최적화(SEO, Search Engine Optimization)`에 유용함
- 검색 엔진이 정보를 가져오는 과정
    - 검색 엔진 로봇(머신)이 페이지에 진입
    - 페이지가 HTML 정보를 로봇에게 제공 (단, 다운로드만 하고 코드 실행은 하지 않음)
    - 제공받은 HTML 페이지 내부의 오픈 그래프나 메타 태그 정보를 기반으로 페이지의 검색 정보를 가져옴
    - 이를 바탕으로 검색 엔진에 정보를 저장
- `CSR` 방식으로 개발된 페이지를 `빈 페이지로 인식`할 가능성이 큼
    - 메타 정보를 제공할 수 있는 조치 필요
- `SSR` 방식은 `서버에서 전부 렌더링`하기 때문에 `HTML에 모든 정보(메타 태그 등)이 저장`되어 있음
    - 검색 엔진 최적화에 대응하기 좋음

<br>

**누적 레이아웃 이동이 적다**

- `누적 레이아웃 이동 (Cumulative Layout Shift)`
    - 사용자에게 페이지를 보여준 이후 뒤늦게 HTML 정보가 추가/삭제되어 화면이 깜빡이는 부정적인 경험
    - 즉, 사용자가 `예상치 못한 시점에 페이지가 변경`되어 불편을 초래하는 것
- `CSR` 방식은 페이지 콘텐츠가 `API 요청에 의존함`
    - API 요청의 응답 속도는 제각각임 (비동기적)
    - 이를 적절히 처리하지 않으면 누적 레이아웃 이동 문제 발생
- `SSR` 방식은 요청이 모두 완료된 이후 `완성된 페이지 제공`
    - 누적 레이아웃 이동 문제에 비교적 자유로움

<br>

**사용자의 디바이스 성능에 비교적 자유롭다**

- 자바스크립트 리소스 실행은 사용자의 디바이스에서만 실행됨
    - 디바이스 성능에 의존적
- `CSR` 방식은 모든 코드를 디바스에서 실행
- `SSR` 방식은 이러한 부담을 서버에 나눌 수 있음
    - 물론 사용자가 몰려 서버에 부담이 가는 경우, 느려질 수 있음

<br>

**보안에 좀 더 안전하다**

- `JAM 스택`을 선택했을 경우 발생하는 문제점 (SPA)
    - `모든 작업이 브라우저에 노출됨`
    - API 호출, 인증과 같이 민감한 작업 정보도 노출됨 → 보안에 취약
- `SSR` 방식은 민감한 작업을 서버에서 처리한 후 제공 가능 → 조금 더 안전함

<br>

### 3) 단점

---

**소스코드를 작성할 때 항상 서버를 고려해야 한다**

- `SSR` 방식은 소스코드 전반에 걸쳐 서버 환경에 대한 고려가 필요함
    - `window`, `sessionStorage` 처럼 브라우저에만 있는 전역 객체가 서버에서 실행될 경우 → 에러 발생
        - 해당 코드가 서버에서 실행되지 않도록 별도의 처리 필요
    - 사용하는 라이브러리가 서버에 대한 고려가 되어있지 않는데 서버에서 실행될 경우 → 에러 발생
        - 다른 라이브러리를 찾거나 별도의 처리 필요

<br>

**적절한 서버가 구축되어 있어야 한다**

- `SPA` 또는 정적인 HTML 페이지만으로 구성된 서비스
    - 서버는 정적 데이터인 자바스크립트와 HTML을 제공하면 끝남
- `SSR`의 경우 고려해야 할 것이 많음
    - 렌더링을 수행할 별도의 서버
    - 사용자의 요청에 적절히 대응할 수 있는 리소스
    - 예기치 않은 장애 상황에 대응할 수 있는 복구 전략 (PM2와 같은 프로세스 매니저)

<br>

**서비스 지연에 따른 문제**

- 무거운 작업이 있을 경우
    - `CSR` 은 최초의 어떤 화면이라도 보여준 상태
    - `SSR` 은 해당 작업이 끝날 때까지 기다려야 함