# 1.5 이벤트 루프와 비동기 통신의 이해

자바스크립트는 싱글스레드에서 작동한다.
그러나 싱글 스레드 기반의 자바스크립트에서도 많은 양의 비동기 작업이 이루어진다.

- 이번 장으로부터 얻을 수 있는 것
  - 자바스크립트에서 어떻게 여러 가지 요청을 동시에 처리하고 있는지
  - 이러한 요청을 받은 태스크에 대한 우선순위는 무엇일까
  - 주의할 점을 무엇일까

## 1.5.1 싱글 스레드 자바스크립트

#### 스레드란?

- 프로그램의 상태가 메모리상에서 실행되는 작업 단위인 **프로세스(process)** 는 하나의 프로그램에 하나만 할당되는데 여러 개의 복작한 작업을 수행하기 위해서는 더 작은 실행단위인 **스레드(thread)** 가 필요했다.

#### 프로세스에서 여러 개의 스레드를 만들 수 있다.

- 스레드끼리는 메모리를 공유할 수 있어 여러 가지 작업을 동시에 수행할 수 있다.
  - 프로세스 내부에서 여러 개의 스레드를 활용하면서 동시 다발적인 작업 처리 가능

#### 자바스크립트가 싱글 스레드라는 것

- 자바스크립트 코드의 실행이 하나의 스레드에서 순차적으로 이루어짐
- 하나의 작업이 끝나기 전까지는 뒤이은 작업이 실행되지 않음

#### Run-to-completion

- 자바스크립트의 모드 코드는 '동기적'으로 한 번에 하나씩 순차적으로 처리

#### 비동기

- 여러 작업을 동시에 수행할 수 있음

## 1.5.2 이벤트 루프

- 이벤트 루프
  - 자바스크립트 런타임 외부에서 자바스크립트 비동기 실행을 돕기 위해 만들어진 장치
  - 호출 스택이 비고, 콜백이 실행 가능한 때가 오면 이것을 꺼내서 수행하는 역할
- 호출 스택(call stack)
  - 자바스크립트에서 수행해야 할 코드나 함수를 순차적으로 담아두는 스택
- 태스크 큐
  - 실행해야 할 태스크의 집합
  - 태스크란 비동기 함수의 콜백함수나 이벤트 핸들러
  - queue 형태가 아닌 set 형태이다

## 1.5.3 태스크 큐와 마이크로 태스크 큐

#### 마이크로 태스크 큐

- 이벤트 루프는 하나의 마이크로 태스크 큐를 가짐
- 마이크로 태스크 큐는 기조의 태스크 큐와는 다른 태스크를 처리
- 대표적으로 `Promise`가 존재
- 기존 태스크 큐보다 우선권을 가짐
  - setTimeout과 setInterval은 Promise보다 늦게 실행된다.
  - 마이크로 태스크 큐가 빌 때까지는 기존 태스크 큐의 실행은 뒤로 미루어짐

#### 대표적인 작업

- 태스크 큐 : setTimeout, setInterval, setImmediate
- 마이크로 태스크 큐 : process.nextTick, Promises, queueMicroTask, MutationObserver

#### 렌더링이 일어나는 시기

- 태스크 큐를 실행하기에 앞서 먼저 마이크로 태스크 큐를 실행하고, 이 마이크로 태스크 큐를 실행한 뒤에 랜더링이 일어남
- 큐가 다 비워져야 렌더링 됨

브라우저를 랜더링 하는 작업은 `마이크로 태스크 큐`와 `태스크 큐` 사이에 일어남
